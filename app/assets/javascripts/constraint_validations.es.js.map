{"version":3,"file":"constraint_validations.es.js","sources":["../../javascript/constraint_validations/index.js"],"sourcesContent":["export default class ConstraintValidations {\n  static connect(element = document, options = {}) {\n    new this(element, options).connect()\n  }\n\n  constructor(element = document, options = {}) {\n    this.element = element\n    this.options = options\n  }\n\n  connect() {\n    this.element.addEventListener(\"invalid\", this.reportFieldValidity, { capture: true, passive: false })\n    this.element.addEventListener(\"blur\", this.clearAndReportFieldValidity, { capture: true, passive: true })\n    this.element.addEventListener(\"input\", this.toggleSubmitsDisabled)\n\n    this.reportValidationMessages()\n  }\n\n  disconnect() {\n    this.element.removeEventListener(\"invalid\", this.reportFieldValidity)\n    this.element.removeEventListener(\"blur\", this.clearAndReportFieldValidity)\n    this.element.removeEventListener(\"input\", this.toggleSubmitsDisabled)\n  }\n\n  reportFieldValidity = (event) => {\n    if (isFieldElement(event.target) && this.reportValidity(event.target)) {\n      event.preventDefault()\n\n      focusFirstInvalidField(event.target.form || event.target)\n    }\n  }\n\n  clearAndReportFieldValidity = ({ target }) => {\n    if (isFieldElement(target)) {\n      this.clearValidity(target)\n      this.reportValidity(target)\n    }\n  }\n\n  toggleSubmitsDisabled = ({ target }) => {\n    if (isFieldElement(target) && this.willDisableSubmitWhenInvalid(target)) {\n      disableSubmitWhenInvalid(target.form)\n    }\n  }\n\n  reportValidationMessages() {\n    for (const invalidElement of this.element.querySelectorAll(\"[aria-errormessage]\")) {\n      const id = invalidElement.getAttribute(\"aria-errormessage\")\n      const validationMessage = document.getElementById(id)\n\n      if (validationMessage) {\n        invalidElement.setCustomValidity(validationMessage.textContent)\n      }\n    }\n  }\n\n  willDisableSubmitWhenInvalid(target) {\n    return typeof this.options.disableSubmitWhenInvalid === \"function\" ?\n      this.options.disableSubmitWhenInvalid(target) :\n      !!this.options.disableSubmitWhenInvalid\n  }\n\n  clearValidity(input) {\n    input.setCustomValidity(\"\")\n\n    this.reportValidity(input)\n  }\n\n  reportValidity(input) {\n    const id = input.getAttribute(\"aria-errormessage\")\n    const validationMessage = getValidationMessage(input)\n    const element = document.getElementById(id) || createValidationMessageFragment(input.form)\n\n    if (input.form?.noValidate) {\n      return false\n    } else if (id && element) {\n      element.id = id\n      element.innerHTML = validationMessage\n\n      if (validationMessage) {\n        input.setCustomValidity(validationMessage)\n        input.setAttribute(\"aria-describedby\", id)\n        input.setAttribute(\"aria-invalid\", \"true\")\n      } else {\n        input.removeAttribute(\"aria-describedby\")\n        input.removeAttribute(\"aria-invalid\")\n      }\n\n      if (!element.parentElement) {\n        input.insertAdjacentElement(\"afterend\", element)\n      }\n\n      if (input.form && this.willDisableSubmitWhenInvalid(input)) disableSubmitWhenInvalid(input.form)\n\n      return true\n    } else {\n      return false\n    }\n  }\n}\n\nfunction focusFirstInvalidField(element) {\n  let firstInvalidField\n\n  if (element instanceof HTMLFormElement) {\n    for (const field of element.elements) {\n      if (field.validity.valid) {\n        continue\n      } else {\n        firstInvalidField = field\n        break\n      }\n    }\n  } else if (\"validity\" in element && !element.validity.valid) {\n    firstInvalidField = element\n  }\n\n  firstInvalidField?.focus()\n}\n\nfunction disableSubmitWhenInvalid(form) {\n  if (!form || form.noValidate) return\n\n  const isValid = Array.from(form.elements).filter(isFieldElement).every(input => input.validity.valid)\n\n  for (const element of form.elements) {\n    if (element.type == \"submit\") {\n      element.disabled = !isValid\n    }\n  }\n}\n\nfunction createValidationMessageFragment(form) {\n  if (form) {\n    const template = form.querySelector(\"[data-validation-message-template]\")\n\n    return template?.content.children[0].cloneNode()\n  }\n}\n\nfunction getValidationMessage(input) {\n  const validationMessages = Object.entries(readValidationMessages(input))\n\n  const [ _, validationMessage ] = validationMessages.find(([ key ]) => input.validity[key]) || [ null, null ]\n\n  return validationMessage || input.validationMessage\n}\n\nfunction readValidationMessages(input) {\n  try {\n    return JSON.parse(input.getAttribute(\"data-validation-messages\")) || {}\n  } catch(_) {\n    return {}\n  }\n}\n\nfunction isFieldElement(element) {\n  return [ HTMLButtonElement, HTMLInputElement, HTMLObjectElement, HTMLOutputElement, HTMLSelectElement, HTMLTextAreaElement ].some(field => element instanceof field)\n}\n"],"names":[],"mappings":"AAAe,MAAM,qBAAqB,CAAC;AAC3C,EAAE,OAAO,OAAO,CAAC,OAAO,GAAG,QAAQ,EAAE,OAAO,GAAG,EAAE,EAAE;AACnD,IAAI,IAAI,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,OAAO,GAAE;AACxC,GAAG;AACH;AACA,EAAE,WAAW,CAAC,OAAO,GAAG,QAAQ,EAAE,OAAO,GAAG,EAAE,EAAE;AAChD,IAAI,IAAI,CAAC,OAAO,GAAG,QAAO;AAC1B,IAAI,IAAI,CAAC,OAAO,GAAG,QAAO;AAC1B,GAAG;AACH;AACA,EAAE,OAAO,GAAG;AACZ,IAAI,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,mBAAmB,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAE,EAAC;AACzG,IAAI,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAAC,2BAA2B,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,EAAC;AAC7G,IAAI,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,qBAAqB,EAAC;AACtE;AACA,IAAI,IAAI,CAAC,wBAAwB,GAAE;AACnC,GAAG;AACH;AACA,EAAE,UAAU,GAAG;AACf,IAAI,IAAI,CAAC,OAAO,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,mBAAmB,EAAC;AACzE,IAAI,IAAI,CAAC,OAAO,CAAC,mBAAmB,CAAC,MAAM,EAAE,IAAI,CAAC,2BAA2B,EAAC;AAC9E,IAAI,IAAI,CAAC,OAAO,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,qBAAqB,EAAC;AACzE,GAAG;AACH;AACA,EAAE,mBAAmB,GAAG,CAAC,KAAK,KAAK;AACnC,IAAI,IAAI,cAAc,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE;AAC3E,MAAM,KAAK,CAAC,cAAc,GAAE;AAC5B;AACA,MAAM,sBAAsB,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,IAAI,KAAK,CAAC,MAAM,EAAC;AAC/D,KAAK;AACL,GAAG;AACH;AACA,EAAE,2BAA2B,GAAG,CAAC,EAAE,MAAM,EAAE,KAAK;AAChD,IAAI,IAAI,cAAc,CAAC,MAAM,CAAC,EAAE;AAChC,MAAM,IAAI,CAAC,aAAa,CAAC,MAAM,EAAC;AAChC,MAAM,IAAI,CAAC,cAAc,CAAC,MAAM,EAAC;AACjC,KAAK;AACL,GAAG;AACH;AACA,EAAE,qBAAqB,GAAG,CAAC,EAAE,MAAM,EAAE,KAAK;AAC1C,IAAI,IAAI,cAAc,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,4BAA4B,CAAC,MAAM,CAAC,EAAE;AAC7E,MAAM,wBAAwB,CAAC,MAAM,CAAC,IAAI,EAAC;AAC3C,KAAK;AACL,GAAG;AACH;AACA,EAAE,wBAAwB,GAAG;AAC7B,IAAI,KAAK,MAAM,cAAc,IAAI,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,qBAAqB,CAAC,EAAE;AACvF,MAAM,MAAM,EAAE,GAAG,cAAc,CAAC,YAAY,CAAC,mBAAmB,EAAC;AACjE,MAAM,MAAM,iBAAiB,GAAG,QAAQ,CAAC,cAAc,CAAC,EAAE,EAAC;AAC3D;AACA,MAAM,IAAI,iBAAiB,EAAE;AAC7B,QAAQ,cAAc,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,WAAW,EAAC;AACvE,OAAO;AACP,KAAK;AACL,GAAG;AACH;AACA,EAAE,4BAA4B,CAAC,MAAM,EAAE;AACvC,IAAI,OAAO,OAAO,IAAI,CAAC,OAAO,CAAC,wBAAwB,KAAK,UAAU;AACtE,MAAM,IAAI,CAAC,OAAO,CAAC,wBAAwB,CAAC,MAAM,CAAC;AACnD,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,wBAAwB;AAC7C,GAAG;AACH;AACA,EAAE,aAAa,CAAC,KAAK,EAAE;AACvB,IAAI,KAAK,CAAC,iBAAiB,CAAC,EAAE,EAAC;AAC/B;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,KAAK,EAAC;AAC9B,GAAG;AACH;AACA,EAAE,cAAc,CAAC,KAAK,EAAE;AACxB,IAAI,MAAM,EAAE,GAAG,KAAK,CAAC,YAAY,CAAC,mBAAmB,EAAC;AACtD,IAAI,MAAM,iBAAiB,GAAG,oBAAoB,CAAC,KAAK,EAAC;AACzD,IAAI,MAAM,OAAO,GAAG,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,IAAI,+BAA+B,CAAC,KAAK,CAAC,IAAI,EAAC;AAC9F;AACA,IAAI,IAAI,KAAK,CAAC,IAAI,EAAE,UAAU,EAAE;AAChC,MAAM,OAAO,KAAK;AAClB,KAAK,MAAM,IAAI,EAAE,IAAI,OAAO,EAAE;AAC9B,MAAM,OAAO,CAAC,EAAE,GAAG,GAAE;AACrB,MAAM,OAAO,CAAC,SAAS,GAAG,kBAAiB;AAC3C;AACA,MAAM,IAAI,iBAAiB,EAAE;AAC7B,QAAQ,KAAK,CAAC,iBAAiB,CAAC,iBAAiB,EAAC;AAClD,QAAQ,KAAK,CAAC,YAAY,CAAC,kBAAkB,EAAE,EAAE,EAAC;AAClD,QAAQ,KAAK,CAAC,YAAY,CAAC,cAAc,EAAE,MAAM,EAAC;AAClD,OAAO,MAAM;AACb,QAAQ,KAAK,CAAC,eAAe,CAAC,kBAAkB,EAAC;AACjD,QAAQ,KAAK,CAAC,eAAe,CAAC,cAAc,EAAC;AAC7C,OAAO;AACP;AACA,MAAM,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE;AAClC,QAAQ,KAAK,CAAC,qBAAqB,CAAC,UAAU,EAAE,OAAO,EAAC;AACxD,OAAO;AACP;AACA,MAAM,IAAI,KAAK,CAAC,IAAI,IAAI,IAAI,CAAC,4BAA4B,CAAC,KAAK,CAAC,EAAE,wBAAwB,CAAC,KAAK,CAAC,IAAI,EAAC;AACtG;AACA,MAAM,OAAO,IAAI;AACjB,KAAK,MAAM;AACX,MAAM,OAAO,KAAK;AAClB,KAAK;AACL,GAAG;AACH,CAAC;AACD;AACA,SAAS,sBAAsB,CAAC,OAAO,EAAE;AACzC,EAAE,IAAI,kBAAiB;AACvB;AACA,EAAE,IAAI,OAAO,YAAY,eAAe,EAAE;AAC1C,IAAI,KAAK,MAAM,KAAK,IAAI,OAAO,CAAC,QAAQ,EAAE;AAC1C,MAAM,IAAI,KAAK,CAAC,QAAQ,CAAC,KAAK,EAAE;AAChC,QAAQ,QAAQ;AAChB,OAAO,MAAM;AACb,QAAQ,iBAAiB,GAAG,MAAK;AACjC,QAAQ,KAAK;AACb,OAAO;AACP,KAAK;AACL,GAAG,MAAM,IAAI,UAAU,IAAI,OAAO,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,EAAE;AAC/D,IAAI,iBAAiB,GAAG,QAAO;AAC/B,GAAG;AACH;AACA,EAAE,iBAAiB,EAAE,KAAK,GAAE;AAC5B,CAAC;AACD;AACA,SAAS,wBAAwB,CAAC,IAAI,EAAE;AACxC,EAAE,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,UAAU,EAAE,MAAM;AACtC;AACA,EAAE,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,QAAQ,CAAC,KAAK,EAAC;AACvG;AACA,EAAE,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,QAAQ,EAAE;AACvC,IAAI,IAAI,OAAO,CAAC,IAAI,IAAI,QAAQ,EAAE;AAClC,MAAM,OAAO,CAAC,QAAQ,GAAG,CAAC,QAAO;AACjC,KAAK;AACL,GAAG;AACH,CAAC;AACD;AACA,SAAS,+BAA+B,CAAC,IAAI,EAAE;AAC/C,EAAE,IAAI,IAAI,EAAE;AACZ,IAAI,MAAM,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,oCAAoC,EAAC;AAC7E;AACA,IAAI,OAAO,QAAQ,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE;AACpD,GAAG;AACH,CAAC;AACD;AACA,SAAS,oBAAoB,CAAC,KAAK,EAAE;AACrC,EAAE,MAAM,kBAAkB,GAAG,MAAM,CAAC,OAAO,CAAC,sBAAsB,CAAC,KAAK,CAAC,EAAC;AAC1E;AACA,EAAE,MAAM,EAAE,CAAC,EAAE,iBAAiB,EAAE,GAAG,kBAAkB,CAAC,IAAI,CAAC,CAAC,EAAE,GAAG,EAAE,KAAK,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,GAAE;AAC9G;AACA,EAAE,OAAO,iBAAiB,IAAI,KAAK,CAAC,iBAAiB;AACrD,CAAC;AACD;AACA,SAAS,sBAAsB,CAAC,KAAK,EAAE;AACvC,EAAE,IAAI;AACN,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,YAAY,CAAC,0BAA0B,CAAC,CAAC,IAAI,EAAE;AAC3E,GAAG,CAAC,MAAM,CAAC,EAAE;AACb,IAAI,OAAO,EAAE;AACb,GAAG;AACH,CAAC;AACD;AACA,SAAS,cAAc,CAAC,OAAO,EAAE;AACjC,EAAE,OAAO,EAAE,iBAAiB,EAAE,gBAAgB,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,mBAAmB,EAAE,CAAC,IAAI,CAAC,KAAK,IAAI,OAAO,YAAY,KAAK,CAAC;AACtK;;;;"}
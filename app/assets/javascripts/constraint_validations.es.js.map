{"version":3,"file":"constraint_validations.es.js","sources":["../../javascript/constraint_validations/index.js"],"sourcesContent":["const defaultOptions = {\n  disableSubmitWhenInvalid: false,\n  validateOn: [\"blur\", \"input\"],\n}\n\nexport default class ConstraintValidations {\n  static connect(element = document, options = {}) {\n    new this(element, options).connect()\n  }\n\n  constructor(element = document, options = {}) {\n    this.element = element\n    this.options = { ...defaultOptions, ...options }\n  }\n\n  connect() {\n    this.element.addEventListener(\"invalid\", this.reportFieldValidity, { capture: true, passive: false })\n\n    for (const eventName of this.options.validateOn) {\n      this.element.addEventListener(eventName, this.clearAndReportFieldValidity, { capture: true, passive: true })\n    }\n\n    this.element.addEventListener(\"input\", this.toggleSubmitsDisabled)\n\n    this.reportValidationMessages(\n      this.element instanceof HTMLFormElement ?\n        [this.element] :\n        Array.from(this.element.querySelectorAll(\"form\"))\n    )\n  }\n\n  disconnect() {\n    this.element.removeEventListener(\"invalid\", this.reportFieldValidity, { capture: true, passive: false })\n\n    for (const eventName of this.options.validateOn) {\n      this.element.removeEventListener(eventName, this.clearAndReportFieldValidity, { capture: true, passive: true })\n    }\n\n    this.element.removeEventListener(\"input\", this.toggleSubmitsDisabled)\n  }\n\n  reportFieldValidity = (event) => {\n    if (isFieldElement(event.target) && this.reportValidity(event.target)) {\n      event.preventDefault()\n\n      focusFirstInvalidField(event.target.form || event.target)\n    }\n  }\n\n  clearAndReportFieldValidity = ({ target }) => {\n    if (isFieldElement(target)) {\n      this.clearValidity(target)\n      this.reportValidity(target)\n    }\n  }\n\n  toggleSubmitsDisabled = ({ target }) => {\n    if (isFieldElement(target) && this.willDisableSubmitWhenInvalid(target)) {\n      disableSubmitWhenInvalid(target.form)\n    }\n  }\n\n  reportValidationMessages(forms) {\n    const invalidFields = []\n\n    for (const form of forms) {\n      for (const element of Array.from(form.elements).filter(isFieldElement)) {\n        const serverRenderedInvalid = /true/i.test(element.getAttribute(\"aria-invalid\"))\n        const id = element.getAttribute(\"aria-errormessage\")\n        const errorMessageElement = document.getElementById(id)\n        const validationMessage = errorMessageElement?.textContent\n\n        if (validationMessage) {\n          element.setCustomValidity(validationMessage)\n        }\n\n        if (validationMessage || serverRenderedInvalid) {\n          this.reportValidity(element)\n          invalidFields.push(element)\n        }\n\n        if (this.willDisableSubmitWhenInvalid(element)) {\n          disableSubmitWhenInvalid(form)\n        }\n      }\n    }\n\n    const [firstInvalidField] = invalidFields\n    firstInvalidField?.focus()\n  }\n\n  willDisableSubmitWhenInvalid(target) {\n    return typeof this.options.disableSubmitWhenInvalid === \"function\" ?\n      this.options.disableSubmitWhenInvalid(target) :\n      !!this.options.disableSubmitWhenInvalid\n  }\n\n  clearValidity(input) {\n    input.setCustomValidity(\"\")\n\n    this.reportValidity(input)\n  }\n\n  reportValidity(input) {\n    const id = input.getAttribute(\"aria-errormessage\")\n    const validationMessage = getValidationMessage(input)\n    const element = document.getElementById(id) || createValidationMessageFragment(input.form)\n\n    if (input.form?.noValidate) {\n      return false\n    } else if (id && element) {\n      element.id = id\n      element.innerHTML = validationMessage\n\n      if (validationMessage) {\n        input.setCustomValidity(validationMessage)\n        input.setAttribute(\"aria-describedby\", id)\n        input.setAttribute(\"aria-invalid\", \"true\")\n      } else {\n        input.removeAttribute(\"aria-describedby\")\n        input.removeAttribute(\"aria-invalid\")\n      }\n\n      if (!element.parentElement) {\n        input.insertAdjacentElement(\"afterend\", element)\n      }\n\n      if (input.form && this.willDisableSubmitWhenInvalid(input)) disableSubmitWhenInvalid(input.form)\n\n      return true\n    } else {\n      return false\n    }\n  }\n}\n\nfunction focusFirstInvalidField(element) {\n  if (element instanceof HTMLFormElement) {\n    return Array.from(element.elements).some(field => focusFirstInvalidField(field))\n  } else if (isFieldElement(element) && !element.validity.valid) {\n    element.focus()\n    element.scrollIntoView()\n    return true\n  } else {\n    return false\n  }\n}\n\nfunction disableSubmitWhenInvalid(form) {\n  if (!form || form.noValidate) return\n\n  const isValid = Array.from(form.elements).filter(isFieldElement).every(input => input.validity.valid)\n\n  for (const element of form.elements) {\n    if (element.type == \"submit\" && !element.formNoValidate) {\n      element.disabled = !isValid\n    }\n  }\n}\n\nfunction createValidationMessageFragment(form) {\n  if (form) {\n    const template = form.querySelector(\"[data-validation-message-template]\")\n\n    return template?.content.children[0].cloneNode()\n  }\n}\n\nfunction getValidationMessage(input) {\n  const validationMessages = Object.entries(readValidationMessages(input))\n\n  const [ _, validationMessage ] = validationMessages.find(([ key ]) => input.validity[key]) || [ null, null ]\n\n  return validationMessage || input.validationMessage\n}\n\nfunction readValidationMessages(input) {\n  try {\n    return JSON.parse(input.getAttribute(\"data-validation-messages\")) || {}\n  } catch(_) {\n    return {}\n  }\n}\n\nfunction isFieldElement(element) {\n  return !element.disabled && \"validity\" in element && element.willValidate\n}\n"],"names":[],"mappings":"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"}